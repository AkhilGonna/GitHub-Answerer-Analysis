library(readr)
library(sna)
library(igraph)

#Reading the file generated by pyhton code
ARN <- read_delim("C:/Users/Ravali/Desktop/SNA ASS 2/Network/1-ARN_pruned.tsv", 
                  "\t", escape_double = FALSE, trim_ws = TRUE)
ABAN <- read_delim("C:/Users/Ravali/2-ABAN_pruned.tsv", 
                   "\t", escape_double = FALSE, trim_ws = TRUE)
CBEN <- read_delim("C:/Users/Ravali/3-CBEN_pruned.tsv", 
                   "\t", escape_double = FALSE, trim_ws = TRUE)
VBEN <- read_delim("C:/Users/Ravali/4-VBEN_pruned.tsv", 
                   "\t", escape_double = FALSE, trim_ws = TRUE)
VBEN2 <- read_delim("C:/Users/Ravali/5-VBEN2_pruned.tsv", 
                    "\t", escape_double = FALSE, trim_ws = TRUE)

plot_graph<- function(sour,targ){
#data frame is assigned to network with the directed links
df<-data.frame(from=sour,to=targ)
net <- graph_from_data_frame(d=df, directed=T) 
matrix = as.matrix(as_adjacency_matrix(net))
gplot(matrix)
a = page.rank(net)$vector
rank = sort(a,decreasing=TRUE)
return(rank)
}

plot_graph_wei<- function(sour,targ,weig){
  #data frame is assigned to network with the directed links
  df<-data.frame(from=sour,to=targ)
  net <- graph_from_data_frame(d=df, directed=T) 
  matrix = as.matrix(as_adjacency_matrix(net))
  n=1
  for (i in 1:nrow(matrix)){
    for (j in 1:ncol(matrix)){
      if (matrix[i,j]==1){
        weight=as.numeric(weig[n,1])
        matrix[i,j]=weight
        n=n+1
      }}}
  graph1<- graph_from_adjacency_matrix(matrix, weighted=TRUE, mode="directed")
  plot(graph1,edge.label=E(graph1)$weight,edge.label.cex=.5,edge.label.color = 'red',vertex.size = 2,vertex.color = 'yellow',vertex.label=NA,
       edge.color = 'black',edge.arrow.size=.03)
  a = page.rank(graph1)$vector
  rank = sort(a,decreasing=TRUE)
  return(rank)
  #gplot(graph)
}

ARN_rank = plot_graph(ARN['Asker_Id'],ARN['Answerer_Id'])
ABAN_rank = plot_graph(ABAN['Asker_Id'],ABAN['Answerer_Id'])
CBEN_rank = plot_graph(CBEN['Non_Best_Answerer_Id'],CBEN['Best_Answerer_Id'])
VBEN_rank = plot_graph_wei(VBEN['Low Answerer Id'],VBEN['Top Answerer'],VBEN['Weight'])
VBEN2_rank = plot_graph_wei(VBEN2['Low voted user'],VBEN2['Top Voted user'],VBEN2['Weight'])

write.table(ARN_rank, file='ARN_rank.tsv', quote=FALSE, sep='\t', col.names = NA)
write.table(ABAN_rank, file='ABAN_rank.tsv', quote=FALSE, sep='\t', col.names = NA)
write.table(CBEN_rank, file='CBEN_rank.tsv', quote=FALSE, sep='\t', col.names = NA)
write.table(VBEN_rank, file='VBEN_rank.tsv', quote=FALSE, sep='\t', col.names = NA)
write.table(VBEN2_rank, file='VBEN2_rank.tsv', quote=FALSE, sep='\t', col.names = NA)
#is.weighted(net)
#E(net)$weight

#Hits Algorithm
library(Matrix)
HITS<-function(g,k)
{ 
  adj <- get.adjacency(g) 
  nodes <- dim(adj)[1] 
  auth <- c(rep(1,nodes)) 
  hub <- c(rep(1,nodes)) 
  for(i in 1:k){ 
    t_adj <- t(adj) 
    auth <- t_adj%*%hub 
    hub <- adj%*%auth 
    sum_sq_auth <- sum(auth*auth) 
    sum_sq_hub <- sum(hub*hub) 
    auth <- auth/sqrt(sum_sq_auth) 
    hub <- hub/sqrt(sum_sq_hub) 
  } 
  result <- c(auth,hub)   
  return(result) 
}
df<-data.frame(from=CBEN['Non_Best_Answerer_Id'],to=CBEN['Best_Answerer_Id'])
net <- graph_from_data_frame(d=df, directed=T) 
matrix = as.matrix(as_adjacency_matrix(net))
gplot(matrix)
graph_hit<-graph_from_adjacency_matrix(matrix)
kmax<-6
#performing hits on CBEN network
op<-HITS(graph_hit,kmax)
op
